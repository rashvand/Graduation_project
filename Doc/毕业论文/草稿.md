
# 毕业论文草稿

## 绪论

### 研究目的及意义

### 国内外研究现状及分析

#### 国外研究现状

#### 国内研究现状

但是国内尚有大量机房仅由普通房间进行适当改造能源效率极低

### 主要研究内容

研究思路和章节安排

## 上层设计

## 下层设计

### 系统架构

本课题的下层设计主要分为两大部分,分别为监测节点部分以及汇聚节点部分,其中,检测节点主要负责对节点位置所处环境状态进行监测,并有一定的中继功能,汇聚节点负责汇集监测节点的环境数据,进行初步处理后供上层设备查询.

### 汇聚节点的设计

#### 汇聚节点硬件设计

##### 汇聚节点功能需求

汇聚节点主要功能为收集所辖范围内所有监测节点的环境信息,做出适当整合后提供接口供上层设备查看,并且,为了便于工作人员查看,还应提供图形界面来实时显示数据中心机房内各个监测节点的温湿度值

##### 汇聚节点电路设计

1. 汇聚节点芯片的选择
   1. 考虑到汇聚节点需要处理较多数据,且具有屏幕显示功能,需要较大的信息处理速度,本课题采用了ST公司的STM32H7系列处理器
2. 屏幕的选择
   1. 经过比较,本课题选择xx型号的RGB屏幕
3. 汇聚节点外部Flash的选择
   1. 由于汇聚节点具有屏幕显示的功能,需要较大的显存,故使用
4. 原理图
   1. 原理图分块的解释
5. PCB图

##### 汇聚节点方案比较

多种不同的电路方案被应用到了本课题中,以下是其中的几个例子:

#### 汇聚节点软件设计

1. 汇聚节点操作系统的选择
   1. 由于汇聚节点需要对上层设备提供接口以及接收监测节点的数据,即需要较为复杂的调度操作,本课题使用UCOS3作为汇聚节点单片机的操作系统,其具有....
2. 汇聚节点程序流程图

### 监测节点的设计

#### 监测节点硬件设计

##### 监测节点的功能需求

监测节点的主要负责感知环境的温湿度信息,并将数据发送到汇聚节点. 根据其作用,需要具备以下几个特点:

1. 体积较小,能够被放置在较为狭窄的空间中
2. 功耗小,能够依靠锂电池供电较为长时间的运行
3. 精度高,依靠其自带的温湿度传感器,能够较为准确的监测到其周围的温湿度情况

##### 监测节点电路设计

1. 监测节点芯片的选择
   1. 考虑到监测节点需要较小的体积以及较低的能耗,本课题采用了ST公司的STM32F1C8T6型芯片,大小仅为...,在低功耗模式下,其能耗仅为...
2. 监测节点温湿度传感器的选择
   1. 本课题选用DHT11型温湿度传感器,其精度为...,能够满足常规条件下的温湿度测量工作
3. 监测节点唯一ID的设计
   1. 由于传感节点是分散在房间中放置,为了能够分辨不同监测节点,每个节点必须被分配一个唯一的标识,本课题每个监测节点采用2个4脚拨码开关进行标记,最多能够标识255个节点,能够满足监测的要求

##### 监测节点方案比较

与汇聚节点相似,在监测节点的硬件设计部分也实现了多种设计方案,分别如下:

#### 监测节点软件设计

##### 监测节点操作系统的选择

考虑到监测节点中的单片机性能,本课题选择了UCOS2作为监测节点的操作系统,操作系统的特性

##### 监测节点程序流程图

### 传输部分设计

#### 通讯部分的需求

1. 本课题需要实现监测节点与汇聚节点进行低带宽的通讯,以较低的时延传输监测节点的数据

#### 传输部分硬件的选型

1. 不同种通讯方式的比较
2. 为降低系统复杂程度,本课题选用ZigBee模块进行通讯,其特点为:

#### 传输部分传输协议的确定

在硬件选型一章中,通过相关ZIgBee模块,已经实现了物理层传输的功能,即从机可以将其发送的比特传输到主机中,本章主要讨论在物理层的基础上,实现传输层(??)及应用层,以实现从机数据与主机数据的通讯.

加分层图

##### 库函数的串口接收机制

传统的STD库中,其串口接收函数一次仅能接受一个字节,需要使用特殊的字节标识或者超时标志来判断是否一帧接受结束,

hal库是ST公司于..推出的一款新的库函数,...特点,其串口部分实现的特点为可以设置串口接收缓冲区,当指定长度的缓冲区满时调用指定回调函数.使用以上机制,可以实现调用一次函数接收一个帧的效果,

为利用HAL库这一特性, 就需要知道串口接收的每一帧的长度, 为此,本课题设计了两种满足这一条件的协议, 即在传输层使用一种定常协议和不定长协议.

##### 两种传输层协议方案的比较

1. 定常协议方案
   定常协议即传输层中每一帧均为固定长度,主机接收时缓冲区大小固定为一帧长度,当缓冲区满时认为一帧接收完毕.而由于应用层要传输数据量不定长,所以要对应用层传入的数据进行切片,将每一片放入传输层中
   
   应用层数据切片+传入传输层示意图

   在实践中发现,进行切片后,物理层需要以较高的频率发送长度较短的帧, 由于物理层处理能力的限制, 主机接收到的相邻两个帧很可能不是出自同一个包的现象(加接收到不同节点的头帧图),产生这种情况理论上可以增加包缓冲区,但是实现过于复杂,或者增大帧的长度,但是对造成带宽的浪费, 故考虑后放弃了此种通讯方式.

2. 不定长协议
   不定长协议即规定帧的长度可变,一个帧被分为了两部分,即帧头部和帧数据部,其中,帧头部长度固定,其中包含帧数据部长度.在接收一个不定长帧时,分两步进行,首先设定定常缓冲区接收帧头部,从帧头获得帧数据部长度,根据该长度重新设定缓冲区来接收帧数据部.

   应用层+传入传输层示意图

   测试结果表明,该协议能够较好的完成通讯需求,不仅利用了HAL缓冲区机制,而且帧中的信息密度较高,减少了带宽的浪费,.在使用不定长协议后,就可以对应用层数据不做任何操作整个装入帧.

##### 应用层:

根据上一章不定长协议的规定,应用层的数据的长度需要小于...字节,在本课题中,应用层数据为将节点数据结构体,即:

结构体伪代码

#### 汇聚点与上位机的通讯协议

本设计使用modbus作为汇聚点和上位机进行通讯的协议

##### modbus的移植
## 总结与展望